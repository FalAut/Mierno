Ponder.registry((event) => {
    event
        .create(["bloodmagic:dungeon_eye", "mierno:glowing_obsidian"])
        .scene("demon_reactor", "恶魔反应器", (scene, util) => {
            scene.showBasePlate();

            scene.idle(20);

            let alternatorPos = [
                [3, 1, 1],
                [3, 1, 3],
                [1, 1, 3],
                [1, 1, 1],
            ];

            alternatorPos.forEach((pos) => {
                scene.world.setBlock(pos, "bloodmagic:dungeon_alternator", false);
                scene.world.showSection(pos, "down");

                scene.idle(5);
            });

            scene.idle(20);

            let basePos = [
                [2, 1, 1],
                [3, 1, 2],
                [2, 1, 3],
                [1, 1, 2],
                [2, 1, 2],
            ];

            basePos.forEach((pos) => {
                scene.world.setBlock(pos, "bloodmagic:dungeon_polished", false);
                scene.world.showSection(pos, "down");

                scene.idle(5);
            });

            scene.idle(20);

            scene.world.setBlock([2, 2, 2], "bloodmagic:dungeon_eye", false);
            scene.world.showSection([2, 2, 2], "down");

            scene.idle(20);

            let middlePos = [
                [3, 2, 1],
                [3, 2, 3],
                [1, 2, 3],
                [1, 2, 1],
            ];

            middlePos.forEach((pos) => {
                scene.world.setBlock(pos, "bloodmagic:dungeon_polished", false);
                scene.world.showSection(pos, "down");

                scene.idle(5);
            });

            let topPos = [
                [2, 3, 1],
                [2, 3, 3],
                [1, 3, 2],
                [2, 3, 2],
                [3, 3, 2],
            ];

            topPos.forEach((pos) => {
                scene.world.setBlock(pos, "bloodmagic:dungeon_polished", false);
                scene.world.showSection(pos, "down");

                scene.idle(5);
            });

            scene.text(60, "搭建完成后，右键恶魔之眼来启动恶魔反应器").attachKeyFrame();
            scene.showControls(60, [2, 2, 2.5], "left").rightClick();
            scene.overlay.showOutline("red", 1, [2, 2, 2], 60);

            scene.idle(80);

            scene.world.setBlock([2, 2, 2], "bloodmagic:dungeon_controller", false);
            scene.world.createEntity("lightning_bolt", [2, 2, 2]);

            scene.text(190, "然后，").attachKeyFrame();
            let obfuscated =
                "§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????\n§4§k?????????????????????????????";
            scene.text(190, obfuscated).attachKeyFrame();

            let portalPos = [
                [2, 2, 1],
                [1, 2, 2],
                [2, 2, 3],
                [3, 2, 2],
            ];

            portalPos.forEach((pos) => {
                scene.world.setBlock(pos, "evilcraft:spirit_portal", false);
                scene.world.showSection(pos, "up");
            });

            scene.idle(40);
            scene.text(150, obfuscated, [2, 3, 2]).attachKeyFrame().placeNearTarget();

            topPos.forEach((pos) => {
                scene.world.setBlock(pos, "mierno:glowing_obsidian", true);
            });

            scene.idle(40);
            scene.text(110, obfuscated, [1, 2, 1]).attachKeyFrame().placeNearTarget();

            middlePos.forEach((pos) => {
                scene.world.setBlock(pos, "mierno:glowing_obsidian", true);
            });

            scene.idle(40);
            scene.text(70, obfuscated, [2, 1, 1]).attachKeyFrame().placeNearTarget();

            basePos.forEach((pos) => {
                scene.world.setBlock(pos, "mierno:glowing_obsidian", true);
            });

            scene.idle(40);
            scene.text(30, obfuscated, [3, 1, 1]).attachKeyFrame().placeNearTarget();

            alternatorPos.forEach((pos) => {
                scene.world.setBlock(pos, "mierno:glowing_obsidian", true);
            });

            scene.idle(40);

            scene.world.setBlocks([4, 0, 0, 0, 3, 4], "air", true);
        });
});
